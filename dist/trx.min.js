var EventStream,Observable,Property,addEventListener,applyExtraction,applyFilter,applyMapping,assertDomNode,assertFunction,assertNotNull,assertString,fromDomEvent,inArray,isArray,isDomNode,isFunction,isNumber,isObject,isString,needlesInHaystack,__bind=function(t,r){return function(){return t.apply(r,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(t,r){function n(){this.constructor=t}for(var e in r)__hasProp.call(r,e)&&(t[e]=r[e]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};Observable=function(){function t(){this.publish=__bind(this.publish,this),this.subscribe=__bind(this.subscribe,this),this._subscribers=[],this._init.apply(this,arguments)}return t.prototype.subscribe=function(t){return this._subscribers.push(t),this},t.prototype.publish=function(t){var r,n,e,i;for(i=this._subscribers,n=0,e=i.length;e>n;n++)(r=i[n])(t);return this},t}(),Property=function(t){function r(){return this.value=__bind(this.value,this),this.reset=__bind(this.reset,this),r.__super__.constructor.apply(this,arguments)}return __extends(r,t),r.prototype._init=function(t,r,n){var e;return null==n&&(n=0),assertFunction(t),assertFunction(r),this._value=n,this._initialValue=n,e=this,t(function(t){return e._value=r(e._value,t),e.publish(e._value)})},r.prototype.reset=function(){return this._value=this.initialValue},r.prototype.value=function(t){return t&&(this._value=t),this._value},r}(Observable),EventStream=function(t){function r(){return this.filter=__bind(this.filter,this),this.later=__bind(this.later,this),this.extract=__bind(this.extract,this),this.map=__bind(this.map,this),this.createHistory=__bind(this.createHistory,this),this.merge=__bind(this.merge,this),this.addEvent=__bind(this.addEvent,this),r.__super__.constructor.apply(this,arguments)}return __extends(r,t),r.prototype._init=function(t){return isFunction(t)?t(this.publish):void 0},r.prototype.addEvent=function(t){return t(this.publish)},r.prototype.merge=function(t){var n;return n=this,new r(function(r){return n.subscribe(function(t){return r(t)}),t.subscribe(function(t){return r(t)})})},r.prototype.createHistory=function(t){return null==t&&(t=100),this.createProperty(function(r,n){return r.length>t&&r.shift(),r.push(n),r},[])},r.prototype.createProperty=function(t,r){return new Property(this.subscribe,t,r)},r.prototype.map=function(t){var n;return n=this,new r(function(r){return applyMapping(n.subscribe,r,t)})},r.prototype.extract=function(t){var n;return n=this,new r(function(r){return applyExtraction(n.subscriber,r,t)})},r.prototype.later=function(t,r,n){var e,i,u;return i=this,e=function(){return i.publish(r)},u=setTimeout(e,t),isFunction(n)?n(function(){return clearTimeout(u)}):void 0},r.prototype.filter=function(t,n){var e;return e=this,new r(function(r){return applyFilter(e.subscribe,r,t,n)})},r}(Observable),applyMapping=function(t,r,n){return assertNotNull(t,r,n),isFunction(n)?t(function(t){return r(n(t))}):isString(n)||isNumber(n)?t(function(){return r(n)}):void 0},applyFilter=function(t,r,n,e){if(assertNotNull(t,r,n),isString(n)){if(assertNotNull(e),isString(e))return t(function(t){return t[n]===e?r(t):void 0});if(isArray(e))return t(function(t){return inArray(t[n],e)?r(t):void 0})}else{if(isFunction(n))return t(function(t){return n(t)?r(t):void 0});if(isObject(n))return t(function(t){return needlesInHaystack(n,t)?r(t):void 0})}},applyExtraction=function(t,r,n){return isFunction(n)?t(function(t){return r(n(t))}):isString(n)?t(function(t){return r(t[n])}):void 0},inArray=function(t,r){var n,e,i,u;for(console.log(t),assertNotNull(t),assertArray(r),e=!1,i=0,u=r.length;u>i;i++)if(n=r[i],n===t){e=!0;break}return e},needlesInHaystack=function(t,r){var n,e,i,u,s,o;n=!0;for(e in t)if(o=t[e],isObject(o)){u=t[e];for(i in o)if(s=o[i],s!==r[e][i]){n=!1;break}}else if(o!==r[e]){n=!1;break}return n},assertFunction=function(t){if(!isFunction(t))throw new Error("variable must be function -> "+t)},assertString=function(t){if(!isString(t))throw new Error("variable must be String -> "+t)},assertDomNode=function(t){if(!isDomNode(t))throw new Error("variable must be html element ->"+t)},assertNotNull=function(t){var r,n,e,i;for(isArray(t)||(t=[t]),i=[],n=0,e=t.length;e>n;n++){if(r=t[n],!r)throw new Error("variable can not be null");i.push(void 0)}return i},isObject=function(t){return!!t&&t.constructor===Object},isNumber=function(t){return"number"==typeof t||t instanceof Number},isDomNode=function(t){return t.hasOwnProperty("nodeType")},isString=function(t){return"string"==typeof t||t instanceof String},isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},isFunction=function(t){return t instanceof Function},addEventListener=function(t,r,n){return t.addEventListener?t.addEventListener(r,n,!1):t.attachEvent?t.attachEvent("on"+r,n):(r="on"+r,"function"==typeof t[r]&&(n=function(t,r){return function(){return t.apply(this.arguments),r.apply(this.arguments)}}(t[r],n)),t[r]=n),!1},fromDomEvent=function(t,r){return assertNotNull(arguments),isArray(r)||(r=[r]),isArray(t)||(t=[t]),new EventStream(function(n){var e,i,u,s,o,a,c;for(c=[],o=0,a=r.length;a>o;o++)e=r[o],s=isString(e)?document.querySelectorAll(e):[e],c.push(function(){var r,e,o;for(o=[],r=0,e=s.length;e>r;r++)u=s[r],o.push(function(){var r,e,s;for(s=[],r=0,e=t.length;e>r;r++)i=t[r],s.push(addEventListener(u,i,function(t){return n(t)}));return s}());return o}());return c})},window.trx={createStream:function(t){return new EventStream(t)},fromDomEvent:fromDomEvent,createProperty:function(t,r,n){return new Property(t,r,n)}};